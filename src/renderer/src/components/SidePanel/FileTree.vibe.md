# FileTree 组件文档

## 用户需求
### 原始需求
> 需要一个文件树组件，用于显示项目中的文件结构，支持文件状态筛选、搜索和批量操作功能

### 期望效果
- 用户可以浏览项目文件结构
- 支持按翻译状态筛选文件（未翻译、已过时、已翻译）
- 支持文件名搜索功能
- 支持按文件扩展名筛选
- 支持按文件大小筛选
- 提供批量翻译功能入口
- 实时显示翻译进度
- 与后端 API 正确交互

## 实现功能
### 主要功能
- [x] 功能1：文件树展示 - 以树状结构展示文件和目录，支持展开/折叠
- [x] 功能2：状态筛选 - 按翻译状态筛选文件（全部、未译、过时、已译）
- [x] 功能3：文件搜索 - 支持按文件名和路径搜索
- [x] 功能4：扩展名筛选 - 支持按文件扩展名筛选，复选框并排布局
- [x] 功能5：大小筛选 - 支持按文件大小范围筛选（KB）
- [x] 功能6：批量翻译 - 提供批量翻译对话框，支持选择文件
- [x] 功能7：文件选择 - 支持选择文件并高亮显示
- [x] 功能8：API 集成 - 与后端 TranslationService 正确交互
- [x] 功能9：加载状态 - 显示加载中、错误和空状态
- [x] 功能10：翻译进度 - 实时显示批量翻译进度条
- [x] 功能11：智能过滤 - 前端过滤结合后端过滤，提升性能
- [x] 功能12：错误处理 - 完善的错误处理和重试机制

### 批量翻译对话框功能
- [x] 功能1：文件选择 - 支持单选/全选可翻译文件
- [x] 功能2：状态显示 - 显示文件状态（未译/过时）和大小
- [x] 功能3：文件统计 - 显示总文件数和已选文件数
- [x] 功能4：响应式布局 - 适配不同屏幕尺寸

## 技术实现
### 数据结构
- 使用 `FileNode` 接口定义文件树节点
- 集成 `FileStatus` 枚举处理文件状态
- 支持递归的文件树结构

### 状态管理
- 使用 React Hooks 管理组件状态
- 实现加载、错误、翻译进度等状态
- 使用 `useMemo` 优化性能

### API 集成
- 通过 `window.api.translation` 调用后端服务
- 支持文件树获取、批量翻译等操作
- 计划支持事件监听（翻译进度、完成通知）

### 过滤逻辑
- 前端实现智能过滤，减少不必要的 API 调用
- 支持多条件组合过滤
- 保持目录结构的完整性

## 变更历史
### v1.0.0
- **变更类型**: 新增
- **变更原因**: 初始创建文件树组件
- **变更内容**: 实现基础文件树展示和筛选功能

### v1.1.0
- **变更类型**: 修改
- **变更原因**: 优化UI设计，采用简约风格
- **变更内容**: 
  - 改进整体布局，使用更现代的设计风格
  - 优化文件扩展名筛选器为并排布局
  - 统一颜色方案和交互效果
  - 改进状态图标和颜色显示
  - 优化搜索框和筛选器布局

### v1.2.0
- **变更类型**: 修改
- **变更原因**: 与后端FileInfo类型保持一致，添加扩展名字段
- **变更内容**: 
  - 给FileNode接口添加extension字段
  - 更新mock数据包含扩展名信息
  - 优化扩展名提取逻辑，直接使用extension字段而非从文件名解析

### v2.0.0
- **变更类型**: 重构
- **变更原因**: 完整集成后端API，实现真实的文件树功能
- **变更内容**: 
  - 移除mock数据，集成真实的后端API调用
  - 重构FileNode接口，使用fileInfo对象包含文件详细信息
  - 实现完整的批量翻译对话框功能
  - 添加加载状态、错误处理和重试机制
  - 实现智能的前端过滤逻辑
  - 添加翻译进度显示功能
  - 优化文件树渲染性能
  - 统一使用FileStatus枚举处理文件状态
  - 添加文件大小格式化显示
  - 实现目录自动展开功能
  - 改进用户交互体验

### 待实现功能
- [x] 事件监听：监听来自主进程的翻译进度和完成事件
- [ ] 快捷键支持：添加键盘快捷键操作
- [ ] 右键菜单：添加文件/目录右键菜单
- [ ] 拖拽排序：支持文件拖拽操作
- [ ] 文件预览：添加文件内容预览功能

### v2.1.0
- **变更类型**: 修复
- **变更原因**: 解决应用启动时"未选择项目"错误
- **变更内容**: 
  - 修复 loadFileTree 函数在没有项目选择时的错误处理
  - 添加项目选择状态检查，优雅处理未选择项目的情况
  - 改进错误显示UI，对"请先选择项目"显示友好提示
  - 添加项目选择和上游更新事件监听，自动刷新文件树
  - 优化错误提示的视觉效果和用户体验

### v2.2.0
- **变更类型**: 性能优化
- **变更原因**: 解决文件树加载缓慢的问题
- **变更内容**: 
  - 实现批量文件信息获取，将 N+1 问题优化为 O(1)
  - 添加 30 秒缓存机制，避免重复获取相同数据
  - 优化 Git 操作，使用单个命令获取所有文件的 hash 和大小
  - 添加强制刷新功能（右键刷新按钮）
  - 在翻译完成后自动清除缓存，确保数据最新
  - 大幅提升文件树加载速度（从秒级优化到毫秒级） 